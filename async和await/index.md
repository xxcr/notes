

## å‰è¨€

çœ‹è¿™ç¯‡æ–‡ç« ä¹‹å‰å¸Œæœ›ä½ æŒæ¡ï¼š

+ `JavaScript`çš„äº‹ä»¶å¾ªç¯
+ æµè§ˆå™¨è¿›ç¨‹å’Œçº¿ç¨‹
+ `Promise`ç›¸å…³çŸ¥è¯†



## ç®€å•è¯´ä¸‹JSçš„å¼‚æ­¥ç¼–ç¨‹

### JSå•çº¿ç¨‹ã€åŒæ­¥å’Œå¼‚æ­¥

#### JSå•çº¿ç¨‹

`Javascript`è¯­è¨€çš„æ‰§è¡Œç¯å¢ƒæ˜¯"å•çº¿ç¨‹"ã€‚ä¹Ÿå°±æ˜¯æŒ‡ä¸€æ¬¡åªèƒ½å®Œæˆä¸€ä»¶ä»»åŠ¡ã€‚å¦‚æœæœ‰å¤šä¸ªä»»åŠ¡ï¼Œå°±å¿…é¡»æ’é˜Ÿï¼Œå‰é¢ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå†æ‰§è¡Œåé¢ä¸€ä¸ªä»»åŠ¡ã€‚

è¿™ç§æ¨¡å¼è™½ç„¶å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œæ‰§è¡Œç¯å¢ƒç›¸å¯¹å•çº¯ï¼Œä½†æ˜¯åªè¦æœ‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œåé¢çš„ä»»åŠ¡éƒ½å¿…é¡»æ’é˜Ÿç­‰ç€ï¼Œä¼šæ‹–å»¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚å¸¸è§çš„æµè§ˆå™¨æ— å“åº”ï¼ˆå‡æ­»ï¼‰ï¼Œå¾€å¾€å°±æ˜¯å› ä¸ºæŸä¸€æ®µ`Javascript`ä»£ç é•¿æ—¶é—´è¿è¡Œï¼ˆæ¯”å¦‚æ­»å¾ªç¯ï¼‰ï¼Œå¯¼è‡´æ•´ä¸ªé¡µé¢å¡åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œå…¶ä»–ä»»åŠ¡æ— æ³•æ‰§è¡Œã€‚

ä¸ºä»€ä¹ˆ`JavaScript`æ˜¯å•çº¿ç¨‹ï¼Ÿ

JavaScriptçš„å•çº¿ç¨‹ï¼Œä¸å®ƒçš„ç”¨é€”æœ‰å…³ã€‚ä½œä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼ŒJavaScriptçš„ä¸»è¦ç”¨é€”æ˜¯ä¸ç”¨æˆ·äº’åŠ¨ï¼Œä»¥åŠæ“ä½œDOMã€‚è¿™å†³å®šäº†å®ƒåªèƒ½æ˜¯å•çº¿ç¨‹ï¼Œå¦åˆ™ä¼šå¸¦æ¥å¾ˆå¤æ‚çš„åŒæ­¥é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå‡å®šJavaScriptåŒæ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸ªDOMèŠ‚ç‚¹ä¸Šæ·»åŠ å†…å®¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ é™¤äº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶æµè§ˆå™¨åº”è¯¥ä»¥å“ªä¸ªçº¿ç¨‹ä¸ºå‡†ï¼Ÿ

æ‰€ä»¥ï¼Œä¸ºäº†é¿å…å¤æ‚æ€§ï¼Œä»ä¸€è¯ç”Ÿï¼ŒJavaScriptå°±æ˜¯å•çº¿ç¨‹ã€‚

WebWorkerï¼ŒJSçš„å¤šçº¿ç¨‹ï¼Ÿ

MDNçš„å®˜æ–¹è§£é‡Šæ˜¯ï¼š

```js
Web Workerä¸ºWebå†…å®¹åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè„šæœ¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ã€‚çº¿ç¨‹å¯ä»¥æ‰§è¡Œä»»åŠ¡è€Œä¸å¹²æ‰°ç”¨æˆ·ç•Œé¢

ä¸€ä¸ªworkeræ˜¯ä½¿ç”¨ä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡(e.g. Worker()) è¿è¡Œä¸€ä¸ªå‘½åçš„JavaScriptæ–‡ä»¶ 

è¿™ä¸ªæ–‡ä»¶åŒ…å«å°†åœ¨å·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç ; workers è¿è¡Œåœ¨å¦ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ä¸­,ä¸åŒäºå½“å‰çš„window

å› æ­¤ï¼Œä½¿ç”¨ windowå¿«æ·æ–¹å¼è·å–å½“å‰å…¨å±€çš„èŒƒå›´ (è€Œä¸æ˜¯self) åœ¨ä¸€ä¸ª Worker å†…å°†è¿”å›é”™è¯¯
```

è¿™æ ·ç†è§£ä¸‹ï¼š

- åˆ›å»º`Worker`æ—¶ï¼ŒJSå¼•æ“å‘æµè§ˆå™¨ç”³è¯·å¼€ä¸€ä¸ªå­çº¿ç¨‹ï¼ˆå­çº¿ç¨‹æ˜¯æµè§ˆå™¨å¼€çš„ï¼Œå®Œå…¨å—ä¸»çº¿ç¨‹æ§åˆ¶ï¼Œè€Œä¸”ä¸èƒ½æ“ä½œDOMï¼‰
- JSå¼•æ“çº¿ç¨‹ä¸workerçº¿ç¨‹é—´é€šè¿‡ç‰¹å®šçš„æ–¹å¼é€šä¿¡ï¼ˆpostMessage APIï¼Œéœ€è¦é€šè¿‡åºåˆ—åŒ–å¯¹è±¡æ¥ä¸çº¿ç¨‹äº¤äº’ç‰¹å®šçš„æ•°æ®ï¼‰

æ‰€ä»¥ï¼Œå¦‚æœæœ‰éå¸¸è€—æ—¶çš„å·¥ä½œï¼Œè¯·å•ç‹¬å¼€ä¸€ä¸ªWorkerçº¿ç¨‹ï¼Œè¿™æ ·é‡Œé¢ä¸ç®¡å¦‚ä½•ç¿»å¤©è¦†åœ°éƒ½ä¸ä¼šå½±å“JSå¼•æ“ä¸»çº¿ç¨‹ï¼Œ åªå¾…è®¡ç®—å‡ºç»“æœåï¼Œå°†ç»“æœé€šä¿¡ç»™ä¸»çº¿ç¨‹å³å¯ï¼Œperfect!

è€Œä¸”æ³¨æ„ä¸‹ï¼Œ**JSå¼•æ“æ˜¯å•çº¿ç¨‹çš„**ï¼Œè¿™ä¸€ç‚¹çš„æœ¬è´¨ä»ç„¶æœªæ”¹å˜ï¼ŒWorkerå¯ä»¥ç†è§£æ˜¯æµè§ˆå™¨ç»™JSå¼•æ“å¼€çš„å¤–æŒ‚ï¼Œä¸“é—¨ç”¨æ¥è§£å†³é‚£äº›å¤§é‡è®¡ç®—é—®é¢˜ã€‚



#### åŒæ­¥å’Œå¼‚æ­¥

1. åŒæ­¥ï¼šè¿ç»­ä¸é—´æ–­å¾—æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå…·æœ‰é˜»å¡æ•ˆåº”ï¼›
2. å¼‚æ­¥ï¼šä¸è¿ç»­å¾—æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä¸å…·æœ‰é˜»å¡æ•ˆåº”ã€‚

ç®€å•æ¥ç†è§£å°±æ˜¯ï¼šåŒæ­¥æŒ‰ä½ çš„ä»£ç é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥ä¸æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œã€‚



### 1. å›è°ƒå‡½æ•°

å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥æ“ä½œæœ€åŸºæœ¬çš„æ–¹æ³•ã€‚ä»¥ä¸‹ä»£ç å°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°çš„ä¾‹å­ï¼š

```js
ajax(url, () => {
    // å¤„ç†é€»è¾‘
})
```

ä½†æ˜¯å›è°ƒå‡½æ•°æœ‰ä¸€ä¸ªè‡´å‘½çš„å¼±ç‚¹ï¼Œå°±æ˜¯å®¹æ˜“å†™å‡º**å›è°ƒåœ°ç‹±ï¼ˆCallback hellï¼‰**ã€‚å‡è®¾å¤šä¸ªè¯·æ±‚å­˜åœ¨ä¾èµ–æ€§ï¼Œä½ å¯èƒ½å°±ä¼šå†™å‡ºå¦‚ä¸‹ä»£ç ï¼š

```js
ajax(url, () => {
    // å¤„ç†é€»è¾‘
    ajax(url1, () => {
        // å¤„ç†é€»è¾‘
        ajax(url2, () => {
            // å¤„ç†é€»è¾‘
        })
    })
})
```

- ä¼˜ç‚¹ï¼šç®€å•ã€å®¹æ˜“ç†è§£å’Œå®ç°;

- ç¼ºç‚¹ï¼š

- - ä¸åˆ©äºä»£ç çš„é˜…è¯»å’Œç»´æŠ¤ï¼Œå„ä¸ªéƒ¨åˆ†ä¹‹é—´é«˜åº¦è€¦åˆï¼Œä½¿å¾—ç¨‹åºç»“æ„æ··ä¹±ã€æµç¨‹éš¾ä»¥è¿½è¸ªï¼ˆå°¤å…¶æ˜¯å¤šä¸ªå›è°ƒå‡½æ•°åµŒå¥—çš„æƒ…å†µï¼‰;
  - æ¯ä¸ªä»»åŠ¡åªèƒ½æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°;
  - ä¸èƒ½ä½¿ç”¨ try catch æ•è·é”™è¯¯ï¼Œä¸èƒ½ç›´æ¥ returnï¼›
  - æå…¶å®¹æ˜“å†™å‡ºå›è°ƒåœ°ç‹±ï¼ˆCallback hellï¼‰ã€‚

### 2. äº‹ä»¶ç›‘å¬

å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œä¸å–å†³äºä»£ç çš„é¡ºåºï¼Œè€Œå–å†³äºæŸä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚

ä¾‹å¦‚ï¼šfnBå¿…é¡»ç­‰åˆ°fnAæ‰§è¡Œå®Œæˆåæ‰èƒ½æ‰§è¡Œã€‚ï¼ˆè¿™é‡Œé‡‡ç”¨çš„jQueryçš„å†™æ³•ï¼‰

```js
fnA.on('done', fnB) // ä¸ºfnAç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œå½“fnAå‘ç”Ÿdoneäº‹ä»¶ï¼Œå°±æ‰§è¡ŒfnBã€‚

function fnA() {
  setTimeout(function () {

    ... // å¤„ç†é€»è¾‘

    fnA.trigger('done') // æ‰§è¡Œå®Œæˆåï¼Œç«‹å³è§¦å‘doneäº‹ä»¶ï¼Œå¼€å§‹æ‰§è¡ŒfnBã€‚
  }, 1000)
}
```

- ä¼˜ç‚¹ï¼š

- - å¯ç»‘å®šå¤šä¸ªäº‹ä»¶ï¼Œæ¯ä¸ªäº‹ä»¶å¯ä»¥æŒ‡å®šå¤šä¸ªå›è°ƒå‡½æ•°ï¼›
  - "å»è€¦åˆ"ï¼Œæœ‰åˆ©äºå®ç°æ¨¡å—åŒ–ã€‚

- ç¼ºç‚¹ï¼š

- - æ•´ä¸ªç¨‹åºéƒ½è¦å˜æˆäº‹ä»¶é©±åŠ¨å‹ï¼Œè¿è¡Œæµç¨‹ä¼šå˜å¾—å¾ˆä¸æ¸…æ™°
  - å¯è¯»æ€§è¾ƒå·®ï¼Œéš¾ä»¥æ¢³ç†å‡ºç¨‹åºä¸»æµç¨‹ã€‚

### 3. å‘å¸ƒè®¢é˜…

å­˜åœ¨ä¸€ä¸ª"ä¿¡å·ä¸­å¿ƒ"ï¼ŒæŸä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå°±å‘ä¿¡å·ä¸­å¿ƒ"å‘å¸ƒ"ï¼ˆpublishï¼‰ä¸€ä¸ªä¿¡å·ï¼Œå…¶ä»–ä»»åŠ¡å¯ä»¥å‘ä¿¡å·ä¸­å¿ƒ"è®¢é˜…"ï¼ˆsubscribeï¼‰è¿™ä¸ªä¿¡å·ï¼Œä»è€ŒçŸ¥é“ä»€ä¹ˆæ—¶å€™è‡ªå·±å¯ä»¥å¼€å§‹æ‰§è¡Œã€‚è¿™å°±å«åš"å‘å¸ƒ/è®¢é˜…æ¨¡å¼"ï¼ˆpublish-subscribe patternï¼‰ï¼Œåˆç§°"è§‚å¯Ÿè€…æ¨¡å¼"ï¼ˆobserver patternï¼‰ã€‚

ä¾‹å¦‚ï¼šfnBé€šè¿‡è®¢é˜…doneä¿¡å·ï¼Œè§¦å‘æ‰§è¡Œã€‚

```js
Watcher.subscribe('done', fnB) // fnBå‘ä¿¡å·ä¸­å¿ƒWatcherè®¢é˜…doneä¿¡å·ã€‚

function fnA() {
  setTimeout(function () {

    ... // å¤„ç†é€»è¾‘

    Watcher.publish('done') // æ‰§è¡Œå®Œæˆåï¼Œå‘ä¿¡å·ä¸­å¿ƒWatcherå‘å¸ƒdoneä¿¡å·ï¼Œä»è€Œå¼•å‘fnBçš„æ‰§è¡Œã€‚
  }, 1000)
}

function fnB(){

    ... // å¤„ç†é€»è¾‘

    Watcher.unsubscribe('done', fnB); // fnBå®Œæˆæ‰§è¡Œåå–æ¶ˆè®¢é˜…
}
```

- ä¼˜ç‚¹ï¼š

- - æ”¯æŒç®€å•çš„å¹¿æ’­é€šä¿¡ï¼Œå½“å¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè‡ªåŠ¨é€šçŸ¥å·²ç»è®¢é˜…è¿‡çš„å¯¹è±¡ï¼›
  - å‘å¸ƒè€…ä¸è®¢é˜…è€…è€¦åˆæ€§é™ä½ï¼Œå‘å¸ƒè€…åªç®¡å‘å¸ƒä¸€æ¡æ¶ˆæ¯å‡ºå»ï¼Œå®ƒä¸å…³å¿ƒè¿™æ¡æ¶ˆæ¯å¦‚ä½•è¢«è®¢é˜…è€…ä½¿ç”¨ï¼ŒåŒæ—¶ï¼Œè®¢é˜…è€…åªç›‘å¬å‘å¸ƒè€…çš„äº‹ä»¶åï¼Œåªè¦å‘å¸ƒè€…çš„äº‹ä»¶åä¸å˜ï¼Œå®ƒä¸ç®¡å‘å¸ƒè€…å¦‚ä½•æ”¹å˜ï¼›
  - å¯ä»¥é€šè¿‡æŸ¥çœ‹â€œæ¶ˆæ¯ä¸­å¿ƒâ€ï¼Œäº†è§£å­˜åœ¨å¤šå°‘ä¿¡å·ã€æ¯ä¸ªä¿¡å·æœ‰å¤šå°‘è®¢é˜…è€…ï¼Œä»è€Œç›‘æ§ç¨‹åºçš„è¿è¡Œã€‚

- ç¼ºç‚¹ï¼š

- - åˆ›å»ºâ€œæ¶ˆæ¯ä¸­å¿ƒâ€éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´å’Œå†…å­˜ï¼›
  - è™½ç„¶å¯ä»¥å¼±åŒ–å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œå¦‚æœè¿‡åº¦ä½¿ç”¨çš„è¯ï¼Œåè€Œä½¿ä»£ç å¯è¯»æ€§åŠå¯ç»´æŠ¤æ€§é™ä½ã€‚

### 4. Promise/A+

> è¿™ä¸ªå¯ä»¥å†™ä¸€å¤§ç¯‡æ–‡ç« äº†ï¼Œè¿™é‡Œç®€å•è¿‡ä¸€ä¸‹ï¼Œæ¯•ç«Ÿä¸»è§’æ˜¯async/await

1. `Promise`æœ¬æ„æ˜¯æ‰¿è¯ºï¼Œåœ¨ç¨‹åºä¸­çš„æ„æ€å°±æ˜¯æ‰¿è¯ºæˆ‘è¿‡ä¸€æ®µæ—¶é—´åä¼šç»™ä½ ä¸€ä¸ªç»“æœã€‚

2. `Promise`çš„ä¸‰ç§çŠ¶æ€

   - Pending----`Promise`å¯¹è±¡å®ä¾‹åˆ›å»ºæ—¶å€™çš„åˆå§‹çŠ¶æ€
   - Fulfilled----å¯ä»¥ç†è§£ä¸ºæˆåŠŸçš„çŠ¶æ€
   - Rejected----å¯ä»¥ç†è§£ä¸ºå¤±è´¥çš„çŠ¶æ€

   **è¿™ä¸ªæ‰¿è¯ºä¸€æ—¦ä»ç­‰å¾…çŠ¶æ€å˜æˆä¸ºå…¶ä»–çŠ¶æ€å°±æ°¸è¿œä¸èƒ½æ›´æ”¹çŠ¶æ€äº†**

3. `promise`çš„é“¾å¼è°ƒç”¨

   - æ¯æ¬¡è°ƒç”¨è¿”å›çš„éƒ½æ˜¯ä¸€ä¸ªæ–°çš„`Promise`å®ä¾‹(è¿™å°±æ˜¯thenå¯ç”¨é“¾å¼è°ƒç”¨çš„åŸå› )
   - å¦‚æœ`then`ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªç»“æœçš„è¯ä¼šæŠŠè¿™ä¸ªç»“æœä¼ é€’ä¸‹ä¸€æ¬¡`then`ä¸­çš„æˆåŠŸå›è°ƒ
   - å¦‚æœ`then`ä¸­å‡ºç°å¼‚å¸¸,ä¼šèµ°ä¸‹ä¸€ä¸ª`then`çš„å¤±è´¥å›è°ƒ
   - åœ¨ `then`ä¸­ä½¿ç”¨äº†`return`ï¼Œé‚£ä¹ˆ `return` çš„å€¼ä¼šè¢«`Promise.resolve()` åŒ…è£…
   - `then`ä¸­å¯ä»¥ä¸ä¼ é€’å‚æ•°ï¼Œå¦‚æœä¸ä¼ é€’ä¼šé€åˆ°ä¸‹ä¸€ä¸ª`then`ä¸­
   - `catch` ä¼šæ•è·åˆ°æ²¡æœ‰æ•è·çš„å¼‚å¸¸

4. æŠŠä¹‹å‰çš„å›è°ƒåœ°ç‹±ä¾‹å­æ”¹å†™ä¸ºå¦‚ä¸‹ä»£ç ï¼š

   ```js
   ajax(url)
     .then(res => {
         console.log(res)
         return ajax(url2) // åŒ…è£…æˆ Promise.resolve(ajax(url2))
     }).then(res => {
         console.log(res)
         return ajax(url3)
     }).then(res => console.log(res))
   ```

   - ä¼˜ç‚¹ï¼š

   - - è§£å†³äº†å›è°ƒåœ°ç‹±
     - èƒ½å¤Ÿé€šè¿‡å›è°ƒå‡½æ•°æ•è·é”™è¯¯

   - ç¼ºç‚¹ï¼š

   - - æ— æ³•å–æ¶ˆ`Promise`ï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šæ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆ
     - å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromiseå†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨
     - å½“å¤„äºPendingçŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚

### 5. Generatorï¼ˆç”Ÿæˆå™¨ï¼‰

1. `Generator` æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œã€‚
2. ES6 æ–°å¼•å…¥äº† `Generator` å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ `yield` å…³é”®å­—ï¼ŒæŠŠå‡½æ•°çš„æ‰§è¡ŒæµæŒ‚èµ·ï¼Œé€šè¿‡`next()`æ–¹æ³•å¯ä»¥åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä¸ºæ”¹å˜æ‰§è¡Œæµç¨‹æä¾›äº†å¯èƒ½ï¼Œä»è€Œä¸ºå¼‚æ­¥ç¼–ç¨‹æä¾›è§£å†³æ–¹æ¡ˆã€‚
   - function å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ã€‚
   - è¯­æ³•ä¸Šï¼Œé¦–å…ˆå¯ä»¥æŠŠå®ƒç†è§£æˆï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚
   - Generator å‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ã€‚
   - å¯æš‚åœå‡½æ•°, yieldå¯æš‚åœï¼Œnextæ–¹æ³•å¯å¯åŠ¨ï¼Œæ¯æ¬¡è¿”å›çš„æ˜¯yieldåçš„è¡¨è¾¾å¼ç»“æœã€‚
   - yieldè¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å›undefinedã€‚**nextæ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ªyieldè¡¨è¾¾å¼çš„è¿”å›å€¼**ã€‚

2. æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼š

   ```js
   function *foo(x) {
     let y = 2 * (yield (x + 1))
     let z = yield (y / 3)
     return (x + y + z)
   }
   let it = foo(5)
   console.log(it.next())   // => {value: 6, done: false}
   console.log(it.next(12)) // => {value: 8, done: false}
   console.log(it.next(13)) // => {value: 42, done: true}
   ```

   æˆ‘ä»¬é€è¡Œä»£ç åˆ†æï¼š

   - é¦–å…ˆ Generator å‡½æ•°è°ƒç”¨å’Œæ™®é€šå‡½æ•°ä¸åŒï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨
   - å½“æ‰§è¡Œç¬¬ä¸€æ¬¡ next æ—¶ï¼Œä¼ å‚ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å‡½æ•°æš‚åœåœ¨ yield (x + 1) å¤„ï¼Œæ‰€ä»¥è¿”å› 5 + 1 = 6
   - å½“æ‰§è¡Œç¬¬äºŒæ¬¡ next æ—¶ï¼Œä¼ å…¥çš„å‚æ•°12å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ªyieldè¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå¦‚æœä½ ä¸ä¼ å‚ï¼Œyield æ°¸è¿œè¿”å› undefinedã€‚æ­¤æ—¶ let y = 2 * 12ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª yield ç­‰äº 2 * 12 / 3 = 8
   - å½“æ‰§è¡Œç¬¬ä¸‰æ¬¡ next æ—¶ï¼Œä¼ å…¥çš„å‚æ•°13å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ªyieldè¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ z = 13, x = 5, y = 24ï¼Œç›¸åŠ ç­‰äº 42

3. åŒæ ·å¯ä»¥è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚

   ```js
   function *fetch() {
       yield ajax(urlA, () => {})
       yield ajax(urlB, () => {})
       yield ajax(urlC, () => {})
   }
   let it = fetch()
   let result1 = it.next()
   let result2 = it.next()
   let result3 = it.next()
   ```

   - ä¼˜ç‚¹ï¼š

   - - å¯åˆ†æ­¥æ‰§è¡Œå¹¶å¾—åˆ°å¼‚æ­¥æ“ä½œçš„ç»“æœï¼›
     - å¯çŸ¥æ™“å¼‚æ­¥æ“ä½œæ‰€å¤„çš„è¿‡ç¨‹ï¼›
     - å¯åˆ‡å…¥ä¿®æ”¹å¼‚æ­¥æ“ä½œçš„è¿‡ç¨‹ã€‚

   - ç¼ºç‚¹ï¼š

   - - ä»ç„¶éœ€è¦ä½¿ç”¨å¼‚æ­¥çš„æ€ç»´å»é˜…è¯»ä»£ç ï¼›
     - æ‰‹åŠ¨è¿­ä»£Generatorå‡½æ•°è¾ƒä¸ºéº»çƒ¦ã€‚

### 6. Async/Await

> è¿™ä¸ªæ˜¯ä¸»è§’ï¼Œä¸‹é¢è¯¦ç»†è®²ä¸€ä¸‹

```js
async function fetch() {
    await ajax(url1)
    await ajax(url2)
    await ajax(url3)
}
```



## async/await

async æ˜¯â€œå¼‚æ­¥â€çš„ç®€å†™ï¼Œè€Œ await å¯ä»¥è®¤ä¸ºæ˜¯ async wait çš„ç®€å†™ã€‚

async ç”¨äºç”³æ˜ä¸€ä¸ª function æ˜¯å¼‚æ­¥çš„ï¼Œè€Œ await ç”¨äºç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚

### ä»€ä¹ˆæ˜¯asyncï¼Ÿ

`async` å‡½æ•°æ˜¯ `Generator` å‡½æ•°çš„è¯­æ³•ç³–ã€‚ä½¿ç”¨ å…³é”®å­— `async` æ¥è¡¨ç¤ºï¼Œåœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ `await` æ¥è¡¨ç¤ºå¼‚æ­¥ã€‚

`async`æ˜¯ES7æ–°å‡ºçš„ç‰¹æ€§ï¼Œè¡¨æ˜å½“å‰å‡½æ•°æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹å¯¼è‡´åç»­ä»£ç åœæ­¢è¿è¡Œã€‚



 #### æ€ä¹ˆç”¨ï¼Ÿ

ç”³æ˜ä¹‹åå°±å¯ä»¥è¿›è¡Œè°ƒç”¨äº†

```js
async function asyncFn() {
ã€€ã€€return 'hello world'
}
asyncFn()
```

è¿™æ ·å°±è¡¨ç¤ºè¿™æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¦‚æœfunctionä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªå€¼ï¼Œ`async`ç›´æ¥ä¼šç”¨`Promise.resolve()`åŒ…è£¹ä¸€ä¸‹è¿”å›ã€‚å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œ`Promise.resolve(undefined)`

> `Promise.resolve(x)` å¯ä»¥çœ‹ä½œæ˜¯ `new Promise(resolve => resolve(x))` çš„ç®€å†™ï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿå°è£…å­—é¢é‡å¯¹è±¡æˆ–å…¶ä»–å¯¹è±¡ï¼Œå°†å…¶å°è£…æˆ `Promise` å®ä¾‹ã€‚

å¦‚æœå‡½æ•°å†…éƒ¨æŠ›å‡ºå¼‚å¸¸æˆ–è€…æ˜¯è¿”å›`reject`ï¼Œéƒ½ä¼šä½¿å‡½æ•°çš„`promise`çŠ¶æ€ä¸ºå¤±è´¥`reject`ã€‚

```js
async function e() {    
    throw new Error('1')
}
e().then(success => console.log('æˆåŠŸ', success))   
   .catch(error => console.log('å¤±è´¥', error)) // 1

```



#### async åšä¸€ä»¶ä»€ä¹ˆäº‹æƒ…ï¼Ÿ

**å¸¦ async å…³é”®å­—çš„å‡½æ•°ï¼Œå®ƒä½¿å¾—ä½ çš„å‡½æ•°çš„è¿”å›å€¼å¿…å®šæ˜¯ promise å¯¹è±¡**

ä¹Ÿå°±æ˜¯ï¼š

- å¦‚æœasyncå…³é”®å­—å‡½æ•°è¿”å›çš„ä¸æ˜¯promiseï¼Œä¼šè‡ªåŠ¨ç”¨Promise.resolve()åŒ…è£…ã€‚

- å¦‚æœasyncå…³é”®å­—å‡½æ•°æ˜¾å¼åœ°è¿”å›promiseï¼Œé‚£å°±ä»¥ä½ è¿”å›çš„promiseä¸ºå‡†ã€‚

  æ‰€ä»¥å¦‚æœæŸä¸ªå‡½æ•°è¿”å›çš„æœ¬èº«å°±æ˜¯promiseçš„è¯ï¼Œä¸éœ€è¦ä½¿ç”¨asyncå£°æ˜ã€‚



### ä»€ä¹ˆæ˜¯await

åªèƒ½åœ¨ä½¿ç”¨`async`å®šä¹‰çš„å‡½æ•°é‡Œé¢ä½¿ç”¨ã€‚

`await`æ˜¯ç­‰å¾…çš„æ„æ€ï¼Œé‚£ä¹ˆä»–åœ¨ç­‰ä»€ä¹ˆå‘¢ï¼Ÿ åœ¨MDNä¸Šå†™çš„æ˜¯ï¼š

```js
[return_value] = await expression;
```

ç­‰çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå˜é‡ï¼Œpromiseï¼Œå‡½æ•°ç­‰ã€‚

æ­£å¸¸æƒ…å†µä¸‹ï¼Œawait å‘½ä»¤åé¢è·Ÿç€çš„æ˜¯ Promise ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œä¹Ÿä¼šè¢«è½¬æ¢æˆä¸€ä¸ª ç«‹å³ `resolve` çš„ `Promise`

```js
async function  f() {
    return await 1
}
f().then( v => console.log(v)) // 1
```

å½“ `async` å‡½æ•°æ‰§è¡Œåˆ° `await` çš„æ—¶å€™ï¼Œ`await`åé¢çš„å‡½æ•°ä¼šå…ˆæ‰§è¡Œä¸€é(æ¯”å¦‚await Fn()çš„Fn ,å¹¶éæ˜¯ä¸‹ä¸€è¡Œä»£ç )ï¼Œç„¶åå°±ä¼šè·³å‡ºæ•´ä¸ª`async`å‡½æ•°ï¼Œå‡ºè®©å…¶çº¿ç¨‹ï¼Œæ¥æ‰§è¡Œåé¢jsä»£ç ï¼Œåªæœ‰å½“å…¶ç­‰å¾…çš„åŸºäº`Promise` çš„å¼‚æ­¥æ“ä½œè¢«å…‘ç°æˆ–è¢«æ‹’ç»ä¹‹åæ‰ä¼šæ¢å¤çº¿ç¨‹ã€‚

**async å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡ï¼Œå¿…é¡»ç­‰åˆ°å†…éƒ¨æ‰€æœ‰çš„ await å‘½ä»¤çš„ Promise å¯¹è±¡æ‰§è¡Œå®Œï¼Œæ‰ä¼šå‘ç”ŸçŠ¶æ€æ”¹å˜**ã€‚



### ä¸ºä»€ä¹ˆè¦ç”¨async/await

è§£å†³å›è°ƒåœ°ç‹±è¿™ä¸ªä¸ç”¨è¯´äº†ã€‚

#### ç›¸å¯¹äº**Promise** 

1. æ›´å¥½åœ°å¤„ç† then é“¾

   - çœ‹ä¸Šé¢å¼‚æ­¥ç¼–ç¨‹`Promise`ã€`async`ä»£ç ï¼š `Promise`è¿™ç§æ–¹å¼å……æ»¡äº† `then()` æ–¹æ³•ï¼Œå¦‚æœå¤„ç†æµç¨‹å¤æ‚çš„è¯ï¼Œæ•´æ®µä»£ç å°†å……æ»¡ `then`ã€‚è¯­ä¹‰åŒ–ä¸æ˜æ˜¾ï¼Œä»£ç æµç¨‹ä¸èƒ½å¾ˆå¥½çš„è¡¨ç¤ºæ‰§è¡Œæµç¨‹ã€‚
   - å¦‚ä½•åœæ­¢`Promise`é“¾ï¼Œæ˜¯ä¸€å¤§éš¾ç‚¹ï¼Œæ˜¯æ•´ä¸ª`Promise`æœ€å¤æ‚çš„åœ°æ–¹ã€‚æ¯”å¦‚ï¼šä½ æƒ³åœ¨ç¬¬ä¸€ä¸ª`then`å°±è·³å‡ºé“¾å¼ï¼Œåé¢çš„ä¸æƒ³æ‰§è¡Œäº†ã€‚

2. `Pomise`ä¼ é€’å‚æ•°å¤ªè¿‡éº»çƒ¦ï¼Œçœ‹ç€å¾ˆæ™•ã€‚

   ä¸¾ä¸ªæ —å­ï¼šå‡è®¾ä¸€ä¸ªä¸šåŠ¡ï¼Œåˆ†å¤šä¸ªæ­¥éª¤å®Œæˆï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”æ¯ä¸€ä¸ªæ­¥éª¤éƒ½éœ€è¦ä¹‹å‰æ¯ä¸ªæ­¥éª¤çš„ç»“æœã€‚

   ```js
   function takeLongTime(n) {
       return new Promise(resolve => {
           setTimeout(() => resolve(n + 200), n)
       })
   }
   
   function step1(n) {
       console.log(`step1 with ${n}`)
       return takeLongTime(n)
   }
   
   function step2(m, n) {
       console.log(`step2 with ${m} and ${n}`)
       return takeLongTime(m + n)
   }
   
   function step3(k, m, n) {
       console.log(`step3 with ${k}, ${m} and ${n}`)
       return takeLongTime(k + m + n)
   }
   
   
   function doIt() {
       console.time("doIt")
       const time1 = 300;
       step1(time1)
           .then(time2 => {
               return step2(time1, time2)
                   .then(time3 => [time1, time2, time3])
           })
           .then(times => {
               const [time1, time2, time3] = times
               return step3(time1, time2, time3)
           })
           .then(result => {
               console.log(`result is ${result}`)
           })
   }
   doIt()
   ```

   æœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰ç‚¹å¤æ‚çš„æ ·å­ï¼Ÿé‚£ä¸€å †å‚æ•°å¤„ç†ï¼Œå°±æ˜¯ Promise æ–¹æ¡ˆçš„æ­»ç©´â€”â€” å‚æ•°ä¼ é€’å¤ªéº»çƒ¦äº†ï¼Œçœ‹ç€å°±æ™•ï¼

   ç„¶åç”¨`async/await` æ¥å®ç°ï¼š

   ```javascript
   async function doIt() {
       console.time("doIt")
       const time1 = 300
       const time2 = await step1(time1)
       const time3 = await step2(time2)
       const result = await step3(time3)
       console.log(`result is ${result}`)
   }
   ```

   æ˜¯ä¸æ˜¯æ„Ÿè§‰èˆ’æœå¤šäº†ã€‚



#### ç›¸å¯¹äºGenerator

çœ‹ä¸Šé¢å¼‚æ­¥ç¼–ç¨‹çš„`Generator`ã€`Promise`ã€`async`ä»£ç 

- `Generator` çš„æ–¹å¼è§£å†³äº† `Promise` çš„ä¸€äº›é—®é¢˜ï¼Œæµç¨‹æ›´åŠ ç›´è§‚ã€è¯­ä¹‰åŒ–ã€‚

- `*/yield`å’Œ`async/await`çœ‹èµ·æ¥å…¶å®å·²ç»å¾ˆç›¸ä¼¼äº†ï¼Œå®ƒä»¬éƒ½æä¾›äº†æš‚åœæ‰§è¡Œçš„åŠŸèƒ½ã€‚

ä½†æ˜¯ç›¸è¾ƒäº `Generator`ï¼Œ`async` å‡½æ•°çš„æ”¹è¿›åœ¨äºä¸‹é¢å››ç‚¹ï¼š

- **å†…ç½®æ‰§è¡Œå™¨**ã€‚`Generator` å‡½æ•°çš„æ‰§è¡Œå¿…é¡»ä¾é æ‰§è¡Œå™¨ï¼Œè€Œ `async` å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ï¼Œè°ƒç”¨æ–¹å¼è·Ÿæ™®é€šå‡½æ•°çš„è°ƒç”¨ä¸€æ ·
- **æ›´å¥½çš„è¯­ä¹‰**ã€‚`async` å’Œ `await` ç›¸è¾ƒäº `*` å’Œ `yield` æ›´åŠ è¯­ä¹‰åŒ–
- **æ›´å¹¿çš„é€‚ç”¨æ€§**ã€‚`co` æ¨¡å—çº¦å®šï¼Œ`yield` å‘½ä»¤åé¢åªèƒ½æ˜¯ `Thunk` å‡½æ•°æˆ– `Promise`å¯¹è±¡ã€‚è€Œ `async` å‡½æ•°çš„ `await` å‘½ä»¤åé¢åˆ™å¯ä»¥æ˜¯ Promise æˆ–è€… åŸå§‹ç±»å‹çš„å€¼ï¼ˆNumberï¼Œstringï¼Œbooleanï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œï¼‰
- **è¿”å›å€¼æ˜¯ Promise**ã€‚`async` å‡½æ•°è¿”å›å€¼æ˜¯ `Promise` å¯¹è±¡ï¼Œæ¯” `Generator` å‡½æ•°è¿”å›çš„ `Iterator` å¯¹è±¡æ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `then()` æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚



è¿™é‡Œçš„é‡ç‚¹æ˜¯è‡ªå¸¦äº†æ‰§è¡Œå™¨ï¼Œç›¸å½“äºæŠŠæˆ‘ä»¬è¦é¢å¤–åšçš„(å†™æ‰§è¡Œå™¨/ä¾èµ–coæ¨¡å—)éƒ½å°è£…äº†åœ¨å†…éƒ¨ã€‚



#### ç”¨åŒæ­¥çš„æ€è·¯å†™å¼‚æ­¥é€»è¾‘

async/await æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨åŒæ­¥çš„æ€è·¯æ¥å†™å¼‚æ­¥çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ‰€ä»¥ä»£ç æ•´ä½“çœ‹èµ·æ¥æ›´åŠ å®¹æ˜“çœ‹æ‡‚ã€‚



### async/awaitçš„æ‰§è¡Œé¡ºåº

ç»“åˆjsçš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹`async/await`çš„æ‰§è¡Œé¡ºåºï¼š

```js
console.log('script start')

async function async1() {
await async2()
console.log('async1 end')
}
async function async2() {
console.log('async2 end')
}
async1()

setTimeout(function() {
console.log('setTimeout')
}, 0)

new Promise(resolve => {
console.log('Promise')
resolve()
})
.then(function() {
console.log('promise1')
})
.then(function() {
console.log('promise2')
})

console.log('script end')

/*
script start
async2 end
Promise
script end
async1 end
promise1
promise2
setTimeout
*/
```

åˆ†æä¸€ä¸‹ï¼š

1. æ‰§è¡Œä»£ç ï¼Œè¾“å‡º`script start`ã€‚
2. æ‰§è¡Œasync1å‡½æ•°ï¼Œæ­¤å‡½æ•°ä¸­åˆè°ƒç”¨äº†async2å‡½æ•°ï¼Œè¾“å‡º`async2 end`ã€‚å›åˆ°async1å‡½æ•°ï¼Œé‡åˆ°äº†awaitï¼Œè®©å‡ºçº¿ç¨‹ï¼Œå…¶åçš„ä»£ç æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚
3. é‡åˆ°setTimeoutï¼Œäº§ç”Ÿä¸€ä¸ªå®ä»»åŠ¡
4. æ‰§è¡ŒPromiseï¼Œè¾“å‡º`Promise`ã€‚é‡åˆ°thenï¼Œäº§ç”Ÿç¬¬ä¸€ä¸ªå¾®ä»»åŠ¡
5. ç»§ç»­æ‰§è¡Œä»£ç ï¼Œè¾“å‡º`script end`
6. ä»£ç é€»è¾‘æ‰§è¡Œå®Œæ¯•(å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•)ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡äº§ç”Ÿçš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¾“å‡ºç¬¬äºŒæ­¥è¢«æ‰”åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡`async1 end`ã€‚
7. æ‰§è¡Œç¬¬ 4 æ­¥è¢«æ‰”åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œè¾“å‡º`promise1`ï¼Œåˆäº§ç”Ÿä¸€ä¸ªå¾®ä»»åŠ¡ï¼ŒåŠ åœ¨åé¢ã€‚
8. æ‰§è¡Œäº§ç”Ÿçš„å¾®ä»»åŠ¡ï¼Œè¾“å‡º`promise2`,å½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ã€‚
9. æœ€åï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå³æ‰§è¡ŒsetTimeoutï¼Œè¾“å‡º`setTimeout`



### async/awaitæ³¨æ„çš„3ä¸ªç‚¹

1. async/awaitä¸­é”™è¯¯å¤„ç†
2. å°å¿ƒ await é˜»å¡
3. forEach ä¸­ç”¨ await 

ä¸‹é¢è¯¦ç»†è¯´ä¸€ä¸‹ã€‚



### async/awaitä¸­é”™è¯¯å¤„ç†

å…ˆæ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```js
let a
async function f() {
    await Promise.reject('error')
    a = await 1 // è¿™æ®µ await å¹¶æ²¡æœ‰æ‰§è¡Œ
}
f().then(v => console.log(a))
```


ä¸Šé¢çš„ä»£ç ï¼Œå½“ `async` å‡½æ•°ä¸­åªè¦ä¸€ä¸ª `await` å‡ºç° reject çŠ¶æ€ï¼Œåˆ™åé¢çš„éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚

`async`å‡½æ•°æ¥æ”¶åˆ°è¿”å›çš„å€¼ï¼Œå‘ç°ä¸æ˜¯`å¼‚å¸¸`æˆ–è€…`reject`ï¼Œåˆ™åˆ¤å®šæˆåŠŸï¼Œè¿™é‡Œå¯ä»¥`return`å„ç§æ•°æ®ç±»å‹çš„å€¼ï¼Œ`false`,`NaN`,`undefined`...æ€»ä¹‹ï¼Œéƒ½æ˜¯`resolve`

ä½†æ˜¯è¿”å›å¦‚ä¸‹ç»“æœä¼šä½¿`async`å‡½æ•°åˆ¤å®šå¤±è´¥`reject`

1. å†…éƒ¨å«æœ‰ç›´æ¥ä½¿ç”¨å¹¶ä¸”æœªå£°æ˜çš„å˜é‡æˆ–è€…å‡½æ•°ã€‚
2. å†…éƒ¨æŠ›å‡ºä¸€ä¸ªé”™è¯¯`throw new Error`æˆ–è€…è¿”å›`reject`çŠ¶æ€`return Promise.reject('æ‰§è¡Œå¤±è´¥')`
3. å‡½æ•°æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼ˆğŸŒ°ï¼šObjectä½¿ç”¨push()ï¼‰ç­‰ç­‰...



é‚£ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘å¸Œæœ› `await` å‡ºç° reject çŠ¶æ€ï¼Œæˆ‘è¿˜æ˜¯éœ€è¦åé¢ä»£ç æ‰§è¡Œï¼Œæ€ä¹ˆåŠï¼Ÿ

1. ç”¨try-catchæ¥åšé”™è¯¯æ•æ‰

   ```js
   let a
   async function correct() {
       try {
           await Promise.reject('error')
       } catch (error) {
           console.log(error)
       }
       a = await 1
       return a
   }
   
   correct().then(v => console.log(a)) // 1
   ```

2. ç”¨promiseçš„catchæ¥åšé”™è¯¯æ•æ‰

   ```js
   let a
   async function correct() {
       await Promise.reject('error').catch((err) => {
           console.log(err)
       })
       a = await 1
       return a
   }
   
   correct().then(v => console.log(a)) // 1
   ```

3. æ›´æ‡’æ›´é«˜é˜¶çš„æ–¹æ³•ï¼šé€šè¿‡ä¸€ä¸ª `webpack loader` æ¥è‡ªåŠ¨æ³¨å…¥ `try/catch` ä»£ç ã€‚



### å°å¿ƒ await é˜»å¡

ç”±äº await èƒ½å¤Ÿé˜»å¡ async å‡½æ•°çš„è¿è¡Œï¼Œæ‰€ä»¥ä»£ç çœ‹èµ·æ¥æ›´åƒåŒæ­¥çš„ä»£ç ï¼Œæ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ã€‚

ä½†æ˜¯è¦å°å¿ƒ await é˜»å¡ï¼Œå› ä¸ºæœ‰äº›é˜»å¡æ˜¯ä¸å¿…è¦çš„ï¼Œä¸æ°å½“ä½¿ç”¨å¯èƒ½ä¼šå½±å“ä»£ç çš„æ€§èƒ½ã€‚

çœ‹ä¸€ä¸ªé”™è¯¯çš„æ —å­ï¼š

```js
async function Fn() {
    let a = await ajax(urla)
    let b = await ajax(urlb)
    console.log(a + b)
}
```

ä¸Šé¢è¿™ä¸ªä»£ç æ˜¯æƒ³æ‹¼æ¥ä¸¤ä¸ªæ¥å£è¯·æ±‚å›æ¥çš„å€¼ï¼Œçœ‹ä¸Šå»å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ï¼šè¯·æ±‚aæ¥å£çš„æ—¶å€™ï¼Œä¼šé˜»å¡æ‰Fnæ–¹æ³•ï¼Œbæ¥å£å°±ä¸ä¼šå»è¯·æ±‚ï¼Œè¦ç­‰aæ¥å£è¿”å›æ•°æ®ã€æœ¬æ¬¡å®ä»»åŠ¡éƒ½æ‰§è¡Œå®Œï¼Œå°†è¯·æ±‚å›æ¥çš„æ•°æ®èµ‹å€¼ç»™aåï¼Œæ‰ä¼šå»è¯·æ±‚bæ¥å£ã€‚è¿™æ ·å†™ç­‰äºæ¯æ¬¡å¼‚æ­¥`http`è¯·æ±‚çº¿ç¨‹æ¯æ¬¡åªè¦ç»´æŠ¤ä¸€ä¸ªè¯·æ±‚ã€‚

è¿™æ ·ä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¯èƒ½æˆ‘è¯·æ±‚bæ¥å£çš„æ—¶å€™ï¼Œjsæ²¡æœ‰ä»€ä¹ˆè¦æ‰§è¡Œçš„äº†ï¼Œå°±è¦ä¸€ç›´ç­‰bæ¥å£è¯·æ±‚å›æ¥æ•°æ®ã€‚å¼‚æ­¥`http`è¯·æ±‚çº¿ç¨‹æ˜æ˜å¯ä»¥ç»´æŠ¤å¤šä¸ªè¯·æ±‚ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š

```js
async function Fn() {
    let aPromise = ajax(urla)
    let bPromise = ajax(urlb)
    let a = await aPromise
    let b = await bPromise
    console.log(a + b)
}

```



è¿™æ ·å†™aè¯·æ±‚å’Œbè¯·æ±‚å¯ä»¥åŒæ—¶è¯·æ±‚ï¼Œæé«˜æ€§èƒ½ã€‚

å½“ç„¶ï¼Œå¦‚æœä½ ç†Ÿæ‚‰ Promise çš„è¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `Promise.all` çš„æ–¹å¼æ¥å¤„ç†ï¼Œæˆ–è€… await åé¢è·Ÿ `Promise.all` è¿™é‡Œå°±ä¸å±•å¼€è®²äº†ã€‚

```js
async function Fn() {
    Promise.all([ajax(urla), ajax(urlb)]).then((values) => {
      console.log(values) // [a, b]
    })
}
```





### forEach ä¸­ç”¨ await 

#### é—®é¢˜

å¯¹äºå¼‚æ­¥ä»£ç ï¼Œ`forEach` å¹¶ä¸èƒ½ä¿è¯æŒ‰é¡ºåºæ‰§è¡Œã€‚

ä¸¾ä¸ªæ —å­ï¼š

ä¸‰ä¸ªè¯·æ±‚ï¼ŒæŒ‰é¡ºåºå¾ªç¯å¾—åˆ°æ•°æ®ï¼š

```js
const urls = [
  'https://1',
  'https://2',
  'https://3'
]

async function test() {
  await urls.forEach(async item => { 
    const res = await ajax(item)
    console.log(res)
  })
  
  console.log('ç»“æŸ')
}

test()
```



æˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯ï¼š

```js
1
2
3
ç»“æŸ
```



ä½†æ˜¯å®é™…ä¸Šå¯èƒ½ä¼šè¾“å‡ºï¼š

ä¸€å¼€å§‹æ‰“å°å‡ºç»“æŸ

```js
ç»“æŸ
2
1
3
```



#### åŸå› 

è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æƒ³æˆ‘ä»¬æœ‰å¿…è¦çœ‹çœ‹`forEach`åº•å±‚æ€ä¹ˆå®ç°çš„ã€‚

```js
// æ ¸å¿ƒé€»è¾‘
for (var i = 0; i < length; i++) {
  if (i in array) {
    var element = array[i]
    callback(element, i, array)
  }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œ`forEach` æ‹¿è¿‡æ¥ç›´æ¥æ‰§è¡Œäº†ï¼Œè¿™å°±å¯¼è‡´å®ƒæ— æ³•ä¿è¯å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚

`for`ç¬¬ä¸€ä¸ªæ—¶ï¼Œåœ¨å†…éƒ¨åˆåˆ›å»ºäº†ä¸€ä¸ª `async ã€await` å½¢å¼çš„æ–¹æ³•ï¼Œ`await`é˜»å¡åé¢çš„ä»£ç ï¼Œè®©å‡ºå½“å‰`async`æ–¹æ³•çš„çº¿ç¨‹ï¼Œç„¶å`for`ç¬¬äºŒä¸ªã€‚

å½“ `forEach` å‡½æ•°æ‰§è¡Œå®Œçš„æ—¶å€™ï¼Œç›¸å½“äºåˆ›å»ºäº† 3 ä¸ª æ–¹æ³•ã€‚æ¯”å¦‚åé¢çš„ä»»åŠ¡ç”¨æ—¶çŸ­ï¼Œé‚£ä¹ˆå¼‚æ­¥`http`çº¿ç¨‹å°±å…ˆå°†å…¶å›è°ƒæ”¾åˆ°å®ä»»åŠ¡é˜Ÿå°¾ã€‚æ‰€ä»¥å…ˆæ‰§è¡Œã€‚

`map`æ–¹æ³•ä¹Ÿä¼šã€‚



#### è§£å†³æ–¹æ¡ˆ

å¦‚ä½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

å…¶å®ä¹Ÿå¾ˆç®€å•, 

1. æˆ‘ä»¬åˆ©ç”¨æ™®é€šçš„`for`å¾ªç¯æˆ–è€…`for...of`å°±èƒ½è½»æ¾è§£å†³ã€‚è¿™ç§æ–¹æ³•æ˜¯ä¸²è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯å‘é€ä¸€ä¸ªè¯·æ±‚å¾—åˆ°ç»“æœï¼Œå†å»å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚

   > ä½¿ç”¨`for...of`å¾ªç¯çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æ˜¯å®ƒä¸Javascriptä¸­çš„å…¶ä»–å¾ªç¯é€‰é¡¹ç›¸æ¯”æ€§èƒ½ä¸å¤Ÿå¥½ã€‚ä½†æ˜¯ï¼Œå°†æ€§èƒ½å‚æ•°ç”¨äºawaitå¼‚æ­¥è°ƒç”¨æ—¶ï¼Œæ€§èƒ½å‚æ•°å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚

   ```js
   const urls = [
     'https://1',
     'https://2',
     'https://3'
   ]
   
   async function test() {
     for(const item of urls) {
   	const res = await ajax(item)
   	console.log(res)
     }
     
     console.log('ç»“æŸ')
   }
   
   test()
   ```

1. å¯ä»¥ç”¨`map`æ–¹æ³•è¿”å›ä¸€ä¸ªå’Œurlæ•°ç»„å¯¹åº”çš„ä¸€ä¸ª`promise` æ•°ç»„ã€‚ç„¶åç”¨`Promise.all`ã€‚è¿™ç§æ–¹æ³•æ˜¯å¹¶è¡Œçš„ã€‚

   > `Promise.all` æ–¹æ³•ä¼šæŒ‰ç…§å¹¶è¡Œçš„æ¨¡å¼ï¼Œå°†æ‰€æœ‰è¯·æ±‚ä¸€æ¬¡æ€§å…¨éƒ¨å‘é€å‡ºå»ï¼Œç„¶åç­‰å¾…æ¥æ”¶åˆ°å…¨éƒ¨ç»“æœåï¼ŒæŒ‰ç…§é¡ºåºæ‰“å°å‡ºæ¥è€Œå·²ã€‚å®ƒå¹¶ä¸ä¼šæŒ‰ç…§é¡ºåºå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ”¶åˆ°ç»“æœåå†å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚

   ```js
   const urls = [
     'https://1',
     'https://2',
     'https://3'
   ]
   
   async function test() {
     let a = urls.map(item => ajax(item))
     
     console.log(await Promise.all(a))
     
     console.log('ç»“æŸ')
   }
   
   test()
   ```

   



#### for...of è§£å†³åŸç†â€”â€”Iterator

è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥å¥½åƒå¾ˆç®€å•å°±èƒ½æå®šï¼Œä½ æœ‰æƒ³è¿‡è¿™ä¹ˆåšä¸ºä»€ä¹ˆå¯ä»¥æˆåŠŸå—ï¼Ÿ

æˆ‘ä»¬éƒ½çŸ¥é“ï¼š`for...of`å¹¶ä¸åƒ`forEach`é‚£ä¹ˆç®€å•ç²—æš´çš„æ–¹å¼å»éå†æ‰§è¡Œï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ç§ç‰¹åˆ«çš„æ‰‹æ®µâ€”â€”`è¿­ä»£å™¨`å»éå†ã€‚

é¦–å…ˆï¼Œå¯¹äºæ•°ç»„æ¥è®²ï¼Œå®ƒæ˜¯ä¸€ç§`å¯è¿­ä»£æ•°æ®ç±»å‹`ã€‚é‚£ä»€ä¹ˆæ˜¯`å¯è¿­ä»£æ•°æ®ç±»å‹`å‘¢ï¼Ÿ

> åŸç”Ÿå…·æœ‰[Symbol.iterator]å±æ€§æ•°æ®ç±»å‹ä¸ºå¯è¿­ä»£æ•°æ®ç±»å‹ã€‚å¦‚æ•°ç»„ã€ç±»æ•°ç»„ï¼ˆå¦‚argumentsã€NodeListï¼‰ã€Setå’ŒMapã€‚

å¯è¿­ä»£å¯¹è±¡å¯ä»¥é€šè¿‡è¿­ä»£å™¨è¿›è¡Œéå†ã€‚

```js
const urls = [
  'https://1',
  'https://2',
  'https://3'
]
// è¿™å°±æ˜¯è¿­ä»£å™¨
let iterator = urls[Symbol.iterator]()
console.log(iterator.next())
console.log(iterator.next())
console.log(iterator.next())
console.log(iterator.next())


// {value: 'https://1', done: false}
// {value: 'https://2', done: false}
// {value: 'https://3', done: false}
// {value: undefined, done: true}
```

å› æ­¤ï¼Œæˆ‘ä»¬çš„ä»£ç å¯ä»¥è¿™æ ·æ¥ç»„ç»‡:

```js
async function test() {
  const urls = [
      'https://1',
      'https://2',
      'https://3'
  ]
  // è¿™å°±æ˜¯è¿­ä»£å™¨
  let iterator = urls[Symbol.iterator]()
  let res = iterator.next()
  while(!res.done) {
    let value = res.value
    console.log(value)
    await ajax(value)
    res = iterater.next()
  }
  console.log('ç»“æŸ')
}
// 1
// 2
// 3
// ç»“æŸ
```

å¤šä¸ªä»»åŠ¡æˆåŠŸåœ°æŒ‰é¡ºåºæ‰§è¡Œï¼å…¶å®åˆšåˆšçš„for...ofå¾ªç¯ä»£ç å°±æ˜¯è¿™æ®µä»£ç çš„è¯­æ³•ç³–ã€‚



#### é‡æ–°è®¤è¯†ç”Ÿæˆå™¨

å›å¤´å†çœ‹çœ‹ç”¨`iterator`éå†`urls`è¿™ä¸ªæ•°ç»„çš„ä»£ç ã€‚

å’¦ï¼Ÿè¿”å›å€¼æœ‰`value`å’Œ`done`å±æ€§ï¼Œç”Ÿæˆå™¨ä¹Ÿå¯ä»¥è°ƒç”¨ `next`,è¿”å›çš„ä¹Ÿæ˜¯è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¹ˆå·§?!

æ²¡é”™ï¼Œ**ç”Ÿæˆå™¨**æœ¬èº«å°±æ˜¯ä¸€ä¸ª**è¿­ä»£å™¨**ã€‚

æ—¢ç„¶å±äºè¿­ä»£å™¨ï¼Œé‚£å®ƒå°±å¯ä»¥ç”¨`for...of`éå†äº†å§ï¼Ÿ

å½“ç„¶æ²¡é”™ã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚



## å‚è€ƒæ–‡çŒ®

1. [JS å¼‚æ­¥ç¼–ç¨‹å…­ç§æ–¹æ¡ˆ](https://juejin.cn/post/6844903760280420366)
2. [[è¯‘]async-await æ•°ç»„å¾ªç¯çš„å‡ ä¸ªå‘](https://juejin.cn/post/6844903793117626376)
3. [ç†è§£async/await](https://juejin.cn/post/6844903960910757902)
4. [ä¸€æ¬¡æ€§è®©ä½ æ‡‚async/awaitï¼Œè§£å†³å›è°ƒåœ°ç‹±](https://juejin.cn/post/6844903621360943118)
5. [ç»†è¯´ async/await ç›¸è¾ƒäº Promise çš„ä¼˜åŠ¿](https://juejin.cn/post/6844903760217505805)
6. [ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ async/await ï¼Ÿ](https://juejin.cn/post/6967000766032658440)
7. [ç†è§£ async/await](https://juejin.cn/post/6844903487805849613)



